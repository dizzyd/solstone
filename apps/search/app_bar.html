<style>
.search-bar-input {
  flex: 1;
  min-width: 0;
  padding: 0.75em 1em;
  border: 1px solid #d1d5db;
  border-radius: 20px;
  font-family: inherit;
  font-size: 14px;
  line-height: 1.5;
  transition: border-color 0.15s, box-shadow 0.15s;
}

.search-bar-input:focus {
  outline: none;
  border-color: var(--facet-color, #2563eb);
  box-shadow: 0 0 0 3px var(--facet-bg, rgba(37, 99, 235, 0.1));
}

.search-bar-input::placeholder {
  color: #9ca3af;
}
</style>

<!-- Use display:contents to make form invisible to flexbox -->
<form id="search-bar-form" style="display: contents;">
  <input
    type="text"
    id="search-bar-input"
    class="search-bar-input"
    placeholder="Search your journal..."
    autocomplete="off"
  >
</form>

<script>
(function() {
  const form = document.getElementById('search-bar-form');
  const input = document.getElementById('search-bar-input');
  if (!form || !input) return;

  // Focus input on page load if nothing else is focused
  setTimeout(() => {
    if (document.activeElement === document.body) {
      input.focus();
    }
  }, 100);

  // Handle form submission
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    window.dispatchEvent(new CustomEvent('search.submit', {
      detail: { query: input.value.trim() }
    }));
  });

  // Listen for external query updates (hash changes)
  window.addEventListener('search.queryUpdate', (e) => {
    input.value = e.detail.query || '';
  });
})();
</script>
